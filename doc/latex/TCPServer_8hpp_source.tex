\hypertarget{TCPServer_8hpp_source}{}\doxysection{TCPServer.\+hpp}
\label{TCPServer_8hpp_source}\index{src/TCPServer.hpp@{src/TCPServer.hpp}}

\begin{DoxyCode}{0}
\DoxyCodeLine{1 }
\DoxyCodeLine{2 \textcolor{comment}{//}}
\DoxyCodeLine{3 \textcolor{comment}{//  TCPSerber.hpp specifies a class which define a server using the TCP }}
\DoxyCodeLine{4 \textcolor{comment}{//  protocol.}}
\DoxyCodeLine{5 \textcolor{comment}{//}}
\DoxyCodeLine{7 \textcolor{comment}{}\textcolor{preprocessor}{\#ifndef TCPSERVER\_HPP}}
\DoxyCodeLine{8 \textcolor{preprocessor}{\#define TCPSERVER\_HPP}}
\DoxyCodeLine{9 }
\DoxyCodeLine{10 \textcolor{preprocessor}{\#include <boost/asio.hpp>}}
\DoxyCodeLine{11 \textcolor{preprocessor}{\#include <boost/bind/bind.hpp>}}
\DoxyCodeLine{12 }
\DoxyCodeLine{13 \textcolor{preprocessor}{\#include "{}Server.hpp"{}}}
\DoxyCodeLine{14 \textcolor{preprocessor}{\#include "{}Connection.hpp"{}}}
\DoxyCodeLine{15 }
\DoxyCodeLine{16 \textcolor{comment}{//Not good here}}
\DoxyCodeLine{17 \textcolor{keyword}{using }boost::asio::ip::tcp;}
\DoxyCodeLine{18 }
\DoxyCodeLine{19 \textcolor{keyword}{class }\mbox{\hyperlink{classTCPServer}{TCPServer}} : \textcolor{keyword}{public} \mbox{\hyperlink{classServer}{Server}} \{}
\DoxyCodeLine{20 }
\DoxyCodeLine{21   \textcolor{keyword}{public}:}
\DoxyCodeLine{22     \mbox{\hyperlink{classTCPServer}{TCPServer}}(boost::asio::io\_context \&, \textcolor{keywordtype}{int});}
\DoxyCodeLine{23     \mbox{\hyperlink{classTCPServer}{\string~TCPServer}}();}
\DoxyCodeLine{24   \textcolor{keyword}{private}:}
\DoxyCodeLine{25     \textcolor{comment}{//Variables}}
\DoxyCodeLine{26     tcp::acceptor m\_acceptor;}
\DoxyCodeLine{27     \textcolor{keywordtype}{int} m\_port;}
\DoxyCodeLine{28     \textcolor{comment}{//Functions}}
\DoxyCodeLine{29     \textcolor{keywordtype}{void} m\_start\_accept(\textcolor{keywordtype}{void});}
\DoxyCodeLine{30     \textcolor{keywordtype}{void} m\_handle\_accept(\mbox{\hyperlink{structServer_1_1m__connection__database__record__t}{m\_connection\_database\_record\_t}},}
\DoxyCodeLine{31                          \textcolor{keyword}{const} boost::system::error\_code \&);}
\DoxyCodeLine{32 \};}
\DoxyCodeLine{33 }
\DoxyCodeLine{34 TCPServer::TCPServer(boost::asio::io\_context\& executor, \textcolor{keywordtype}{int} port)}
\DoxyCodeLine{35   : \mbox{\hyperlink{classServer}{Server}}(executor), }
\DoxyCodeLine{36     m\_acceptor(m\_get\_executor(), tcp::endpoint(tcp::v4(), port))}
\DoxyCodeLine{37 \{}
\DoxyCodeLine{38   m\_port = port;}
\DoxyCodeLine{39   std::cerr << \textcolor{stringliteral}{"{}INFO: TCPServer ("{}} << m\_port << \textcolor{stringliteral}{"{}): m\_handle\_accept: started "{}}}
\DoxyCodeLine{40             << \textcolor{stringliteral}{"{}async accept chain operation..."{}} << std::endl;}
\DoxyCodeLine{41   m\_start\_accept();}
\DoxyCodeLine{42 \}}
\DoxyCodeLine{43 }
\DoxyCodeLine{44 TCPServer::\string~TCPServer() \{\}}
\DoxyCodeLine{45 }
\DoxyCodeLine{46 \textcolor{keywordtype}{void} TCPServer::m\_handle\_accept(m\_connection\_database\_record\_t new\_connection,}
\DoxyCodeLine{47                                 \textcolor{keyword}{const} boost::system::error\_code\& error)}
\DoxyCodeLine{48 \{}
\DoxyCodeLine{49   std::cerr << \textcolor{stringliteral}{"{}INFO: TCPServer ("{}} << m\_port << \textcolor{stringliteral}{"{}): m\_handle\_accept: async "{}}}
\DoxyCodeLine{50             << \textcolor{stringliteral}{"{}accept event happened..."{}} << std::endl;}
\DoxyCodeLine{51   \textcolor{keywordflow}{if}(!error) \{}
\DoxyCodeLine{52     new\_connection.remote\_ip = }
\DoxyCodeLine{53       new\_connection.connection\_ptr-\/>get\_socket().remote\_endpoint().address();}
\DoxyCodeLine{54     new\_connection.port = }
\DoxyCodeLine{55       new\_connection.connection\_ptr-\/>get\_socket().remote\_endpoint().port();}
\DoxyCodeLine{56     m\_insert\_new\_connection(new\_connection);}
\DoxyCodeLine{57     std::cerr << \textcolor{stringliteral}{"{}INFO: TCPServer ("{}} << m\_port << \textcolor{stringliteral}{"{}): m\_handle\_accept: new "{}}}
\DoxyCodeLine{58               << \textcolor{stringliteral}{"{}connection plugged."{}} << std::endl;}
\DoxyCodeLine{59   \}}
\DoxyCodeLine{60   m\_start\_accept();}
\DoxyCodeLine{61 \}}
\DoxyCodeLine{62 }
\DoxyCodeLine{63 \textcolor{keywordtype}{void} TCPServer::m\_start\_accept(\textcolor{keywordtype}{void}) \{}
\DoxyCodeLine{64   \mbox{\hyperlink{structServer_1_1m__connection__database__record__t}{Server::m\_connection\_database\_record\_t}} new\_connection;}
\DoxyCodeLine{65   new\_connection.connection\_ptr.reset(\textcolor{keyword}{new} \mbox{\hyperlink{classConnection}{Connection}}(m\_get\_executor()));}
\DoxyCodeLine{66 }
\DoxyCodeLine{67   m\_acceptor.async\_accept(new\_connection.connection\_ptr-\/>get\_socket(),}
\DoxyCodeLine{68     boost::bind(\&TCPServer::m\_handle\_accept, \textcolor{keyword}{this}, new\_connection, }
\DoxyCodeLine{69     boost::asio::placeholders::error));}
\DoxyCodeLine{70 \}}
\DoxyCodeLine{71 }
\DoxyCodeLine{72 \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
